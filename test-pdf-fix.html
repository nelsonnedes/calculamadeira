<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Corre√ß√£o PDF - Vers√£o 2.1.3</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #8B0000;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }
        .step {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .step h3 {
            color: #8B0000;
            margin-top: 0;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .info {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #2196F3;
        }
        .warning {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }
        button {
            background-color: #8B0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #660000;
        }
        .code {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Teste de Corre√ß√£o PDF v2.1.3</h1>
        <p>Verifica√ß√£o das corre√ß√µes aplicadas no sistema</p>
    </div>

    <div class="step">
        <h3>üìã Status das Corre√ß√µes</h3>
        <div id="statusCorrections"></div>
    </div>

    <div class="step">
        <h3>üßπ Limpeza de Cache</h3>
        <div class="warning">
            <strong>‚ö†Ô∏è IMPORTANTE:</strong> Para aplicar as corre√ß√µes, voc√™ deve limpar o cache do navegador:
        </div>
        <br>
        <div class="info">
            <strong>Como limpar o cache:</strong><br>
            ‚Ä¢ <strong>Chrome/Edge:</strong> Ctrl + Shift + Delete ‚Üí Selecionar "Imagens e arquivos em cache" ‚Üí Limpar<br>
            ‚Ä¢ <strong>Firefox:</strong> Ctrl + Shift + Delete ‚Üí Selecionar "Cache" ‚Üí Limpar<br>
            ‚Ä¢ <strong>Ou simplesmente:</strong> Pressione <code>Ctrl + F5</code> para recarregar for√ßado
        </div>
        <br>
        <button onclick="clearCacheAndReload()">üîÑ Limpar Cache e Recarregar</button>
        <button onclick="forceReload()">‚ö° Recarga For√ßada (Ctrl+F5)</button>
    </div>

    <div class="step">
        <h3>üîç Teste das Fun√ß√µes PDF</h3>
        <p>Ap√≥s limpar o cache, teste os bot√µes PDF em <a href="orcamentos.html" target="_blank">orcamentos.html</a></p>
        <div class="info">
            <strong>Teste esperado:</strong><br>
            ‚úÖ Bot√£o "PDF C/Pre√ßo" - deve abrir PDF com pre√ßos unit√°rios<br>
            ‚úÖ Bot√£o "PDF S/Pre√ßo" - deve abrir PDF sem pre√ßos unit√°rios<br>
            ‚úÖ Sem erros no console do navegador
        </div>
    </div>

    <div class="step">
        <h3>üêõ Verifica√ß√£o de Erros</h3>
        <div id="errorCheck"></div>
        <button onclick="checkConsoleErrors()">üîç Verificar Erros no Console</button>
    </div>

    <div class="step">
        <h3>üìÑ Informa√ß√µes T√©cnicas</h3>
        <div class="code">
            <strong>Vers√£o do Sistema:</strong> 2.1.3<br>
            <strong>Cache Name:</strong> calculadora-madeira-v2.1.3<br>
            <strong>Corre√ß√µes Aplicadas:</strong><br>
            ‚Ä¢ TypeError volumeText.includes corrigido<br>
            ‚Ä¢ Service Worker chrome-extension fix<br>
            ‚Ä¢ Padroniza√ß√£o de strings nas fun√ß√µes PDF<br>
            ‚Ä¢ Limpeza autom√°tica de cache
        </div>
    </div>

    <script>
        // Verificar status das corre√ß√µes
        function checkCorrections() {
            const corrections = [
                { name: 'Vers√£o do c√≥digo', status: localStorage.getItem('code-version') === '2.1.3' },
                { name: 'Service Worker registrado', status: 'serviceWorker' in navigator },
                { name: 'HTML2Canvas dispon√≠vel', status: typeof html2canvas !== 'undefined' },
                { name: 'Cache limpo', status: !localStorage.getItem('old-cache-version') }
            ];

            const statusDiv = document.getElementById('statusCorrections');
            statusDiv.innerHTML = corrections.map(correction => 
                `<div style="margin: 5px 0;">
                    ${correction.status ? '‚úÖ' : '‚ùå'} ${correction.name}: 
                    <span class="${correction.status ? 'success' : 'error'}">
                        ${correction.status ? 'OK' : 'Erro'}
                    </span>
                </div>`
            ).join('');
        }

        // Limpar cache e recarregar
        async function clearCacheAndReload() {
            try {
                // Limpar todos os caches
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                    }
                }
                
                // Limpar localStorage relacionado ao cache
                const keysToRemove = Object.keys(localStorage).filter(key => 
                    key.includes('cache') || key.includes('sw-')
                );
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                // Limpar sessionStorage
                sessionStorage.clear();
                
                alert('Cache limpo! A p√°gina ser√° recarregada.');
                window.location.reload(true);
            } catch (error) {
                console.error('Erro ao limpar cache:', error);
                alert('Erro ao limpar cache. Use Ctrl+F5 para recarga for√ßada.');
            }
        }

        // Recarga for√ßada
        function forceReload() {
            window.location.reload(true);
        }

        // Verificar erros no console
        function checkConsoleErrors() {
            const errorDiv = document.getElementById('errorCheck');
            errorDiv.innerHTML = `
                <div class="info">
                    <strong>Como verificar erros:</strong><br>
                    1. Pressione F12 para abrir Developer Tools<br>
                    2. V√° para a aba "Console"<br>
                    3. Acesse orcamentos.html e teste os bot√µes PDF<br>
                    4. Verifique se h√° erros vermelhos no console<br><br>
                    <strong>Erros que devem ter sido corrigidos:</strong><br>
                    ‚ùå TypeError: volumeText.includes is not a function<br>
                    ‚ùå Failed to execute 'put' on 'Cache': Request scheme 'chrome-extension'<br>
                    ‚ùå initializeAutocomplete is not defined
                </div>
            `;
        }

        // Executar verifica√ß√µes ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            checkCorrections();
        });
    </script>
</body>
</html> 
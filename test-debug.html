<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Debug - PDF</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #8B0000;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #660000;
        }
        .debug-info {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste de Debug - Funções PDF</h1>
        
        <div class="debug-info">
            <h3>Informações de Debug:</h3>
            <div id="debug-output"></div>
        </div>
        
        <button onclick="testVolumeFormatting()">Testar Formatação de Volume</button>
        <button onclick="clearCache()">Limpar Cache</button>
        <button onclick="checkLocalStorage()">Verificar LocalStorage</button>
        
        <div id="results"></div>
    </div>

    <script>
        // Função para testar formatação de volume
        function formatVolumeForPDF(volume) {
            try {
                console.log("formatVolumeForPDF: entrada =", volume, "tipo:", typeof volume);
                
                // Se for undefined ou null, retornar valor padrão
                if (volume === undefined || volume === null) {
                    console.log("formatVolumeForPDF: volume é undefined/null, retornando padrão");
                    return '0,000 m³';
                }
                
                // Se for número, formatar diretamente
                if (typeof volume === 'number') {
                    const result = volume.toLocaleString('pt-BR', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' m³';
                    console.log("formatVolumeForPDF: formatado como número =", result);
                    return result;
                }
                
                // Se for string, verificar se já contém 'm³'
                const volumeStr = String(volume);
                console.log("formatVolumeForPDF: convertido para string =", volumeStr);
                
                if (volumeStr.includes('m³')) {
                    console.log("formatVolumeForPDF: string já contém m³");
                    // Extrair apenas o número e reformatar
                    const volumeNumber = parseFloat(volumeStr.replace(/[^0-9,.]/g, '').replace(',', '.'));
                    if (!isNaN(volumeNumber)) {
                        const result = volumeNumber.toLocaleString('pt-BR', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' m³';
                        console.log("formatVolumeForPDF: reformatado =", result);
                        return result;
                    }
                    console.log("formatVolumeForPDF: não conseguiu extrair número, retornando original");
                    return volumeStr;
                }
                
                // Se for string sem 'm³', tentar converter para número
                console.log("formatVolumeForPDF: string sem m³, tentando converter");
                const volumeNumber = parseFloat(volumeStr.replace(/[^0-9,.]/g, '').replace(',', '.'));
                if (!isNaN(volumeNumber)) {
                    const result = volumeNumber.toLocaleString('pt-BR', {minimumFractionDigits: 3, maximumFractionDigits: 3}) + ' m³';
                    console.log("formatVolumeForPDF: convertido e formatado =", result);
                    return result;
                }
                
                // Se nada funcionar, retornar o valor original
                console.log("formatVolumeForPDF: nada funcionou, retornando original =", volumeStr);
                return volumeStr;
            } catch (error) {
                console.error("formatVolumeForPDF: ERRO =", error, "valor:", volume);
                return '0,000 m³';
            }
        }
        
        function testVolumeFormatting() {
            const testCases = [
                1.234,
                "1.234",
                "1,234",
                "1.234 m³",
                "1,234 m³",
                null,
                undefined,
                "abc",
                0,
                ""
            ];
            
            let output = "<h4>Teste de Formatação de Volume:</h4>";
            testCases.forEach(testCase => {
                const result = formatVolumeForPDF(testCase);
                output += `<p><strong>Entrada:</strong> ${JSON.stringify(testCase)} (${typeof testCase}) → <strong>Saída:</strong> ${result}</p>`;
            });
            
            document.getElementById('results').innerHTML = output;
        }
        
        function clearCache() {
            // Limpar cache do navegador
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                    alert('Cache limpo com sucesso!');
                });
            }
            
            // Desregistrar service workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
        }
        
        function checkLocalStorage() {
            const userId = localStorage.getItem('currentUserId');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const quotes = JSON.parse(localStorage.getItem(`quotes_${userId}`) || '[]');
            
            let output = "<h4>Informações do LocalStorage:</h4>";
            output += `<p><strong>currentUserId:</strong> ${userId}</p>`;
            output += `<p><strong>user.email:</strong> ${user.email}</p>`;
            output += `<p><strong>Número de orçamentos:</strong> ${quotes.length}</p>`;
            
            if (quotes.length > 0) {
                output += "<h5>Primeiro orçamento:</h5>";
                const firstQuote = quotes[0];
                output += `<p><strong>ID:</strong> ${firstQuote.id}</p>`;
                output += `<p><strong>totalVolume:</strong> ${JSON.stringify(firstQuote.totalVolume)} (${typeof firstQuote.totalVolume})</p>`;
                output += `<p><strong>clientName:</strong> ${firstQuote.clientName}</p>`;
            }
            
            document.getElementById('results').innerHTML = output;
        }
        
        // Debug inicial
        document.getElementById('debug-output').innerHTML = `
            <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
            <p><strong>Service Worker Support:</strong> ${'serviceWorker' in navigator}</p>
            <p><strong>Cache Support:</strong> ${'caches' in window}</p>
            <p><strong>LocalStorage Keys:</strong> ${Object.keys(localStorage).join(', ')}</p>
        `;
    </script>
</body>
</html> 